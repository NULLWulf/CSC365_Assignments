<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="../css/homepage.css" />
    <script src="../js/homepage.js" defer></script>
    <meta charset="UTF-8" />
    <title>Yelp Similarity Tester</title>
  </head>
  <body>
    <div style="width: 50%; font-size: 14px;"">
      <h1>Yelp Dataset Recommendation Engine</h1>
      <p style="font-size: 14px">
        Select an item from the dropdown to get a randomly related business. The
        relation is determined by a correlation of terms found within the
        businesses' reviews. (Both the selected, and 'related' businesses)
      </p>
      <select id="businesses"></select>
      <p id="relatable">
        Related Business 1: <span id="related1"></span><br />
        Related Business 2: <span id="related2"></span>
      </p>
      <h2>Calculation Process</h2>
      <ul>
        <li><b>1) Pull in JSON DATA:</b>  We start by loading a large JSON dataset of Businesses.  In this case </li>
      </ul>
    </div>

    <script>
      let select = document.getElementById("businesses");

      // function to get random business list and populate select element
      function getBusinessList() {
        fetch("/random")
          .then((response) => response.json())
          .then((data) => {
            // filter out empty values
            let businesses = data.filter(
              (business) => business.business_name.trim() !== ""
            );
            // populate select element
            businesses.forEach((business) => {
              let option = document.createElement("option");
              option.value = business.business_name;
              option.text = business.business_name;
              let input = document.createElement("input");
              input.type = "hidden";
              input.name = "business_id";
              input.value = business.business_id;
              option.appendChild(input);
              select.add(option);
            });
          })
          .catch((error) => console.error(error));
      }
      select.addEventListener("change", () => {
        let selectedOption = select.options[select.selectedIndex];
        let businessId = selectedOption.querySelector(
          '[name="business_id"]'
        ).value;
        fetch(`/relatable?business_id=${businessId}`)
          .then((response) => response.json())
          .then((data) => {
            let relatable = data.slice(0, 2);
            for (let i = 0; i < relatable.length; i++) {
              let relatedName = relatable[i].business_name;
              document.getElementById(`related${i + 1}`).textContent =
                relatedName;
            }
          })
          .catch((error) => console.error(error));
      });

      // call getBusinessList on page load
      window.onload = getBusinessList;
    </script>
  </body>
</html>
